# 근무 시간 관리 달력 - 작업 히스토리

## 개발 일자: 2025-12-23

---

## Phase 1: 프로젝트 초기화 및 기본 구조

### 1.1 파일 생성
- `index.html`: 기본 HTML 구조
- `style.css`: 스타일시트
- `script.js`: JavaScript 로직

### 1.2 초기 기능
- 월별 달력 표시
- 이전/다음 달 네비게이션
- 주말/평일 구분
- 한국 공휴일 데이터 (2024-2027)

### 1.3 데이터 저장
- localStorage 기반 데이터 영속성
- 월별 데이터 구조 설계
- 기본 8시간 설정

---

## Phase 2: 수평 슬라이더 구현

### 2.1 슬라이더 추가
- HTML range input 사용
- 4시간 ~ 12시간 범위
- 0.5시간 (30분) 단위 조정
- 실시간 시간 표시

### 2.2 색상 코딩
- 빨강/주황: 8시간 미만 (부족)
- 초록: 8시간 (목표)
- 파랑: 8시간 초과 (초과)

### 2.3 요약 패널
- 필요 근무시간 계산
- 실제 근무시간 집계
- 부족/초과 표시
- 남은 평일 평균 계산

---

## Phase 3: 자동 조정 시스템 구현

### 3.1 초기 자동 조정
- 오늘 날짜 조정 시 미래 날짜 자동 분배
- 모든 미래 날짜에 균등 분배

### 3.2 문제 발견 및 수정
**문제**: 미래 날짜의 기존 값까지 계산에 포함되어 잘못된 값 계산
**해결**: 오늘까지만 계산하고 미래는 필요 시간만 분배

```javascript
// 수정 전
actualHoursTotal += loadHours(d);  // 모든 날짜 포함

// 수정 후
if (d <= today) {
    actualHoursUpToToday += loadHours(d);  // 오늘까지만
}
```

---

## Phase 4: 분 단위 표시 개선

### 4.1 시분 표시 포맷
- "8h" → "8h 30m" 형식으로 변경
- 15분 단위 조정 (0.25h)
- 정밀한 시간 관리

### 4.2 표시 함수
```javascript
formatHoursMinutes(decimalHours)
// 8.5h → "8h 30m"
// 8.0h → "8h"
```

---

## Phase 5: UI/UX 개선 - 수직 바 디자인

### 5.1 슬라이더 → 수직 바 전환
**문제**: 수평 슬라이더가 직관적이지 않음
**해결**: 클릭/드래그 가능한 수직 바로 변경

### 5.2 구현 내용
- 하단부터 채워지는 수직 바
- 클릭 위치에 따라 시간 설정
- 드래그로 실시간 조정
- 시간 표시를 바 하단으로 이동

### 5.3 최소 높이 보장
**문제**: 4시간일 때 바가 완전히 사라짐 (높이 0%)
**해결**: 4시간 = 15% 최소 높이 설정

```javascript
// 4h = 15%, 13h = 100%
heightPercent = 15 + ((hours - 4) / (13 - 4)) * 85
```

---

## Phase 6: 화면 깨짐 및 부동소수점 오류 수정

### 6.1 문제 발견
- 슬라이더 드래그 시 화면 깨짐
- 부동소수점 오류: "7.900000000000002h"

### 6.2 해결 방법
**화면 깨짐**:
- 전체 달력 재렌더링 제거
- DOM 쿼리로 해당 바만 직접 업데이트

**부동소수점 오류**:
- 모든 숫자 반올림 처리
- 표시 함수에서 깔끔한 형식으로 변환

---

## Phase 7: 수동 조정 추적 시스템

### 7.1 요구사항
- 8시간이 아닌 날짜만 고정 (X)
- 수동으로 조정한 날짜만 고정 (O)

### 7.2 데이터 구조 개선
```javascript
// 이전
{ "2025-12-23": 8 }

// 이후
{
  "2025-12-23": {
    hours: 11,
    manual: true
  }
}
```

### 7.3 자동 조정 로직 개선
```javascript
if (isManuallyModified(date)) {
    // 고정: 자동 조정 제외
    futureWeekdaysManual += hours;
} else {
    // 자동 조정 대상
    futureWeekdaysAuto.push(date);
}
```

---

## Phase 8: 잠금/해제 기능

### 8.1 잠금 아이콘 추가
- 수동 조정 시 🔒 아이콘 표시
- 날짜 번호 옆에 배치
- 시각적 피드백 제공

### 8.2 잠금 해제 기능
- 🔒 클릭 시 잠금 해제
- 즉시 자동 조정 대상으로 전환
- 아이콘 제거

### 8.3 버그 수정
**문제**: 수동 조정 후 잠금 아이콘이 즉시 표시되지 않음
**해결**: 동적 아이콘 추가 함수 구현

```javascript
// 수동 조정 직후
addLockIcon(date);  // 즉시 아이콘 표시
```

---

## Phase 9: 색상 체계 개선

### 9.1 색상 구분 변경
**이전 (3단계)**:
- 빨강: < 8h
- 초록: = 8h
- 파랑: > 8h

**이후 (4단계)**:
- 🔵 파란색: ≤ 4h
- 🟢 초록색: 4h ~ 8h
- 🟠 주황색: 8h ~ 10h
- 🔴 붉은색: > 10h

### 9.2 구현
```javascript
if (hours <= 4) {
    bar.classList.add('low');
} else if (hours <= 8) {
    bar.classList.add('normal');
} else if (hours <= 10) {
    bar.classList.add('high');
} else {
    bar.classList.add('extreme');
}
```

---

## Phase 10: 최종 조정

### 10.1 최대 근무시간 증가
- 12시간 → 13시간
- 더 유연한 시간 관리

### 10.2 조정 단위 개선
- 15분 (0.25h) → 10분 (1/6h)
- 더 정밀한 시간 입력

```javascript
// 15분 단위
Math.round(hours * 4) / 4

// 10분 단위
Math.round(hours * 6) / 6
```

---

## 주요 개선 사항 요약

### 성능 개선
1. 전체 재렌더링 → 부분 DOM 업데이트
2. 불필요한 이벤트 제거
3. 효율적인 데이터 구조

### UX 개선
1. 수평 슬라이더 → 수직 바 (직관성 ↑)
2. 시분 표시 (가독성 ↑)
3. 4단계 색상 (정보 전달력 ↑)
4. 잠금/해제 (유연성 ↑)

### 기능 개선
1. 자동 조정 정확도 향상
2. 수동 조정 추적
3. 10분 단위 정밀 조정
4. 13시간까지 지원

---

## 알려진 제한사항

1. **공휴일 데이터**: 기본값은 2024-2027년만 포함 (사용자가 직접 추가 가능)
2. **브라우저 저장**: localStorage 용량 제한 (약 5MB)
3. **오프라인**: 웹 서버 없이 로컬 파일로만 실행
4. **단일 사용자**: 다중 사용자 지원 없음

---

## 기술 스택

- **HTML5**: 시맨틱 마크업
- **CSS3**: Grid, Flexbox, Gradient
- **JavaScript (ES6+)**:
  - Arrow functions
  - Template literals
  - Destructuring
  - localStorage API
  - Date API
  - FileReader API
  - Blob API
- **라이브러리**: 없음 (Vanilla JS)

---

---

## Phase 11: 계산 로직 수정 및 휴가 기능 (2025-12-23)

### 11.1 날짜 비교 오류 수정
**문제**: 남은 평일 평균 계산이 부정확
**원인**: `today` 변수에 시간 정보 포함으로 날짜 비교 오류
**해결**:
```javascript
const today = new Date();
today.setHours(0, 0, 0, 0);  // 시간 부분 제거
```

### 11.2 남은 평일 평균 계산 수정
**문제**: 오늘이 "지나간 평일"에 포함되어 잘못된 평균 계산
**해결**:
```javascript
// 수정 전: d <= today (오늘 포함)
// 수정 후: d < today (어제까지만)
if (d < today) {
    passedWeekdays++;
}

// 남은 필요 시간 = 총 필요시간 - 어제까지 일한 시간
const remainingHoursNeeded = requiredHours - hoursUpToToday;
```

### 11.3 휴가 기능 구현
**기존**: 휴가 버튼으로 토글
**변경**: 체크박스로 변경
- 날짜 왼쪽에 체크박스 배치
- 체크 시 "제외됨" 표시 및 노란색 배경
- 계산에서 자동 제외 (주말/공휴일과 동일)
- 데이터 구조에 `vacation: boolean` 추가

---

## Phase 12: UI/UX 개선 및 반응형

### 12.1 화면 크기 최적화
**문제**: 화면에 달력이 다 안 들어옴
**해결**:
- container max-width: 1200px → 1100px (고정)
- day-cell min-height: 160px → 110px
- 전체 요소 크기 약 90% 축소
- 상위 영역(헤더, 요약) 여백 축소

### 12.2 이전/다음 달 날짜 표시
**구현**:
- 항상 달력을 채워서 표시 (빈 칸 없음)
- 이전 달 날짜: 월 시작 전 빈 공간 채우기
- 다음 달 날짜: 월 종료 후 빈 공간 채우기
- 다른 달 날짜는 흐리게 표시 (opacity: 0.3)
- 5줄로 충분한 달은 5줄, 6줄 필요한 달은 6줄

```javascript
// 자동 줄 수 계산
const currentCells = startingDayOfWeek + lastDay.getDate();
const totalCells = currentCells <= 35 ? 35 : 42;
```

### 12.3 체크박스 UI 개선
- 체크박스를 날짜 바로 옆에 배치
- justify-content: space-between 제거
- 잠금 아이콘에 margin-left: auto 추가

---

## Phase 13: 시간 조정 정밀도 향상

### 13.1 조정 단위 변경
**진화 과정**:
1. 15분 단위 (0.25h)
2. 10분 단위 (1/6h)
3. 5분 단위 (1/12h)
4. **1분 단위 (1/60h)** ← 최종

```javascript
// 최종
function roundHours(hours) {
    return Math.round(hours * 60) / 60;
}
```

---

## Phase 14: 인트라넷 데이터 가져오기

### 14.1 데이터 넣기 기능
**구현**:
- "데이터 넣기" 버튼 추가 (초록색)
- 팝업 모달 UI
- textarea에 복사한 데이터 붙여넣기
- "적용하기" / "취소" 버튼

### 14.2 데이터 파싱 로직
**지원 형식**: 인트라넷 근무시간 테이블
```
날짜    구분    시간    시작 IP    종료 IP    수정 내역
2025-12-23    업무    09:27 ~    192.168.4.214
2025-12-22    휴게    14:55 ~ 15:27 (00:33)
              업무    09:34 ~ 16:32 (06:59)
```

**파싱 로직**:
1. 탭/여러 공백으로 분리
2. 날짜 인식: 첫 번째 필드가 정확히 `YYYY-MM-DD` 형식
3. "업무" / "휴게" 구분
4. 괄호 안의 시간 추출: `(HH:MM)`
5. 날짜별로 그룹화하여 누적

### 14.3 휴게 시간 차감
**계산**:
```javascript
실제 근무시간 = 업무 시간 - 휴게 시간
```

**예시**:
- 업무: 09:34 ~ 16:32 (06:59)
- 휴게: 14:55 ~ 15:27 (00:33)
- 실제: 6:59 - 0:33 = **6:26**

### 14.4 수정 내역 필터링
**문제**: 수정 내역이 파싱에 간섭
**해결**: 수정 내역 관련 줄 건너뛰기
```javascript
if (line.startsWith('*') ||
    line.startsWith('사유:') ||
    line.includes('시간 수정') ||
    line.includes('시작 시간:') ||
    line.includes('종료 시간:')) {
    continue;
}
```

### 14.5 자동 휴가 설정
**기능**:
- 가장 이른 날짜 ~ 오늘 범위에서
- 데이터가 없는 평일 → 자동으로 "제외" 설정
- 주말/공휴일은 제외

**결과 표시**:
```
15개의 근무시간 데이터를 가져왔습니다.
3개의 날짜를 휴가로 설정했습니다.
```

### 14.6 제외 처리 시간 갱신 수정
**문제**: 제외 처리된 날짜에 데이터 가져올 때 시간이 갱신되지 않음
**원인**: `saveHours`가 vacation 플래그를 보존하지 않고 덮어씀
**해결**:
```javascript
function saveHours(date, hours, isManual = false, clearVacation = false) {
    // vacation 플래그 보존 또는 제거
    vacation: clearVacation ? false : existingVacation
}

// 데이터 가져오기 시
saveHours(date, hours, false, true);  // vacation 해제
```

---

## Phase 15: 공휴일 관리 시스템 (2025-12-23)

### 15.1 요구사항
**기존**: 공휴일이 script.js에 하드코딩됨
**변경**: txt 파일로 관리하고 웹에서 편집 가능하게

### 15.2 데이터 구조 변경

**이전 (객체 구조)**:
```javascript
const koreanHolidays = {
  '2024': [
    { date: '2024-01-01', name: '신정' },
    ...
  ],
  '2025': [...],
  ...
};
```

**이후 (배열 구조 + localStorage)**:
```javascript
const defaultHolidays = [
  { date: '2024-01-01', name: '신정' },
  { date: '2025-01-01', name: '신정' },
  ...
];

let koreanHolidays = loadHolidays(); // from localStorage
```

### 15.3 파일 생성
**holidays.txt**:
```
2024-01-01,신정
2024-02-09,설날 연휴
2024-02-10,설날
...
```
- CSV 형식 (YYYY-MM-DD,이름)
- 2024-2027년 한국 공휴일 67개 포함
- 백업 및 공유용

### 15.4 localStorage 자동 관리
**초기화 로직**:
```javascript
function initializeHolidays() {
    const stored = localStorage.getItem('koreanHolidays');
    if (!stored) {
        // 첫 실행 시 기본 공휴일 저장
        saveHolidaysData(defaultHolidays);
    }
    return loadHolidays();
}
```

**장점**:
- 페이지 로드 시 자동으로 공휴일 불러오기
- 브라우저 새로고침해도 유지
- 수정 사항 즉시 저장

### 15.5 공휴일 관리 UI

**버튼 추가**:
- "공휴일 관리" 버튼 (파란색 #667eea)
- footer에 위치 (이번 달로 돌아가기 / 데이터 넣기 사이)

**모달 구조**:
```html
<div id="holidayModal" class="modal">
  - 제목: "공휴일 관리"
  - 텍스트 영역: 400px 높이, monospace 폰트
  - 버튼: 저장, txt로 내보내기, txt에서 가져오기, 취소
  - 파일 입력: 숨김 요소
</div>
```

### 15.6 주요 기능

**1. 텍스트 편집**:
```javascript
function openHolidayModal() {
    // 현재 공휴일을 CSV 형식으로 변환
    const text = koreanHolidays
        .map(h => `${h.date},${h.name}`)
        .join('\n');
    textarea.value = text;
}
```

**2. 저장**:
```javascript
function saveHolidaysFromTextarea() {
    // 1. CSV 파싱
    // 2. 날짜순 정렬
    // 3. localStorage 저장
    // 4. 달력 재렌더링
    // 5. 성공 메시지
}
```

**3. txt로 내보내기**:
```javascript
function exportHolidaysToFile() {
    // Blob 생성 → URL 생성 → 다운로드
    const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
    a.download = 'holidays.txt';
}
```

**4. txt에서 가져오기**:
```javascript
function importHolidaysFromFile() {
    // 파일 선택 → FileReader로 읽기 → textarea에 로드
    reader.readAsText(file, 'UTF-8');
}
```

### 15.7 파싱 로직 개선
**이름에 쉼표 포함 지원**:
```javascript
const parts = line.split(',');
const date = parts[0].trim();
const name = parts.slice(1).join(',').trim(); // "12-25,크리스마스,성탄절" 지원
```

**정렬 자동화**:
```javascript
holidays.sort((a, b) => a.date.localeCompare(b.date));
```

### 15.8 isHoliday 함수 수정
**이전 (객체 구조)**:
```javascript
function isHoliday(date) {
    const year = date.getFullYear().toString();
    if (!koreanHolidays[year]) return null;
    const holiday = koreanHolidays[year].find(h => h.date === dateStr);
    return holiday ? holiday.name : null;
}
```

**이후 (배열 구조)**:
```javascript
function isHoliday(date) {
    const dateStr = formatDate(date);
    const holiday = koreanHolidays.find(h => h.date === dateStr);
    return holiday ? holiday.name : null;
}
```

### 15.9 이벤트 리스너 추가
```javascript
// 공휴일 관리 모달
document.getElementById('manageHolidays').addEventListener('click', openHolidayModal);
holidayModal.querySelector('.close').addEventListener('click', closeHolidayModal);
document.getElementById('saveHolidays').addEventListener('click', saveHolidaysFromTextarea);
document.getElementById('exportHolidays').addEventListener('click', exportHolidaysToFile);
document.getElementById('importHolidays').addEventListener('click', importHolidaysFromFile);
document.getElementById('cancelHoliday').addEventListener('click', closeHolidayModal);
document.getElementById('holidayFileInput').addEventListener('change', handleHolidayFileSelect);

// 모달 외부 클릭 시 닫기
window.addEventListener('click', (e) => {
    if (e.target === holidayModal) {
        closeHolidayModal();
    }
});
```

### 15.10 CSS 스타일 추가

**버튼 스타일**:
```css
.manage-holidays-button {
    padding: 12px 25px;
    background: #667eea;  /* 파란색 */
    color: white;
    border-radius: 8px;
    transition: background 0.3s;
}

.manage-holidays-button:hover {
    background: #5568d3;
}
```

**텍스트 영역 스타일**:
```css
#holidayTextarea {
    width: 100%;
    min-height: 400px;
    font-family: 'Courier New', monospace;
    line-height: 1.5;
}
```

### 15.11 사용 시나리오

**시나리오 1: 새 공휴일 추가**
1. "공휴일 관리" 클릭
2. 마지막 줄에 `2026-10-09,한글날` 추가
3. "저장" 클릭
4. → 달력에 즉시 반영

**시나리오 2: 회사 공휴일 추가**
1. "공휴일 관리" 클릭
2. `2025-08-20,회사 창립기념일` 추가
3. "저장" 클릭
4. → 해당 날짜가 공휴일로 표시됨

**시나리오 3: 백업**
1. "공휴일 관리" 클릭
2. "txt로 내보내기" 클릭
3. → holidays.txt 다운로드
4. 안전한 곳에 보관

**시나리오 4: 복원**
1. "공휴일 관리" 클릭
2. "txt에서 가져오기" 클릭
3. 백업한 holidays.txt 선택
4. "저장" 클릭
5. → 백업된 공휴일 복원

### 15.12 장점

1. **유연성**: 언제든지 공휴일 추가/삭제 가능
2. **백업**: txt 파일로 쉽게 백업
3. **공유**: txt 파일을 다른 사람과 공유 가능
4. **확장성**: 회사 공휴일, 특별휴일 추가 가능
5. **편의성**: 코드 수정 없이 웹에서 관리
6. **호환성**: 모든 브라우저 지원 (서버 불필요)

### 15.13 파일 변경 요약

**생성**:
- `holidays.txt`: 초기 공휴일 데이터 (67개)

**수정**:
- `script.js`:
  - 데이터 구조 변경 (객체 → 배열)
  - localStorage 관리 함수 추가
  - 공휴일 관리 함수 6개 추가
  - isHoliday 함수 간소화
  - 이벤트 리스너 추가

- `index.html`:
  - "공휴일 관리" 버튼 추가
  - 공휴일 관리 모달 추가
  - 파일 입력 요소 추가

- `style.css`:
  - `.manage-holidays-button` 스타일 추가
  - `#holidayTextarea` 스타일 추가

---

## 최종 기능 요약

### 핵심 기능
1. ✅ 월별 근무시간 관리
2. ✅ 수직 바 UI (클릭/드래그 조정)
3. ✅ 자동 조정 시스템 (미래 날짜)
4. ✅ 수동 잠금/해제
5. ✅ 휴가 관리 (체크박스)
6. ✅ 인트라넷 데이터 가져오기
7. ✅ 이전/다음 달 날짜 표시
8. ✅ 1분 단위 정밀 조정
9. ✅ 공휴일 관리 (웹 편집 + txt 백업/복원)

### 데이터 구조
```javascript
{
  "2025-12": {
    "2025-12-23": {
      hours: 8.5,        // 근무시간 (1분 단위)
      manual: true,      // 수동 조정 여부
      vacation: false    // 휴가 여부
    }
  }
}
```

### 통계 표시
1. 이번 달 필요 근무시간
2. 실제 근무시간
3. 현재까지 근무 시간 (어제까지)
4. 부족/초과
5. 남은 평일 평균 필요 시간

---

## 개발 시간 요약

### Day 1 (초기 개발)
- 기본 구조: ~30분
- 슬라이더 구현: ~20분
- 자동 조정 시스템: ~40분
- 수직 바 전환: ~30분
- 버그 수정 및 개선: ~60분
- 문서화: ~30분

### Day 2 (기능 확장 및 최적화)
- 계산 로직 수정: ~30분
- 휴가 기능 구현: ~40분
- UI/UX 개선: ~50분
- 데이터 가져오기 구현: ~90분
- 버그 수정 및 테스트: ~40분
- 공휴일 관리 시스템: ~60분

**총 개발 시간**: 약 8시간
